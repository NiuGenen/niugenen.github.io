# SJTUçš„äºŒè¿›åˆ¶ç¿»è¯‘ç ”ç©¶æ€»ç»“

è‡ªä»2007å¹´å®ç°äº†CrossBitåï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†è‹¥å¹²ç ”ç©¶ï¼ŒåŒ…æ‹¬ä¼˜åŒ–ã€å®‰å…¨ã€ä¸åŒå½¢æ€çš„ç¿»è¯‘å™¨ç­‰ã€‚

## å®‰å…¨

Nightingaleã€2017ã€‘memvisorã€2012/2014ã€‘Multimemã€2012ã€‘CrossIFã€2010ã€‘system call checkã€2009ã€‘

## ç¿»è¯‘å™¨

BabelFishã€2017ã€‘DistriBitã€2012/2010ã€‘ï¼ŒMTCrossBitã€2011/2009/2008ã€‘ï¼ŒGXBitã€2011/2005ã€‘ï¼ŒCacheBitã€2009ã€‘ï¼ŒvBTransã€2008ã€‘Co-design CrossBitã€2008ã€‘CrossBitã€2007ã€‘

## ä¼˜åŒ–

çƒ­ä»£ç é›†ä¸­ã€2011/2010ã€‘Fast Returnã€2010/2009ã€‘HW-profileã€2009ã€‘Condition Codesã€2009ã€‘ç¡¬ä»¶æŸ¥æ‰¾ç¿»è¯‘ï¼Œä¸æ‰§è¡Œåˆ†ç¦»ã€2009/2008ã€‘profile hot pathã€2008ã€‘Code Cacheæ›¿æ¢ã€2008ã€‘

## ç‰¹å®šé—®é¢˜

å¤§å°ç«¯ã€2011ã€‘è°ƒè¯•Guestã€2008ã€‘æµ®ç‚¹ã€2008ã€‘



# ä¸€ä¸ªç®€å•çš„æ—¶é—´åˆ—è¡¨

2017

- ã€å®‰å…¨ã€‘Nightingaleï¼Œé’ˆå¯¹VMè§£é‡Šå™¨çš„ä»£ç ä¿æŠ¤æ–¹æ¡ˆï¼Œç”¨DBTæ¥ç®€åŒ–VM
- ã€BTã€‘BabelFishï¼Œè½»é‡çº§é™æ€äºŒè¿›åˆ¶ç¿»è¯‘å™¨ï¼Œå°†MIPSè½¬æ¢ä¸ºLLVM-IR

2014

- ã€å®‰å…¨ã€‘memvisorï¼Œå¯¹å†…å­˜è¿›è¡Œå¤‡ä»½ç”¨äºæ¢å¤ï¼Œé€šè¿‡é™æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„æ–¹å¼å¤„ç†è®¿å­˜æ¥å¤‡ä»½

2012

- ã€å®‰å…¨ã€‘Multimemï¼ŒåŒæ ·é€šè¿‡é™æ€äºŒè¿›åˆ¶ç¿»è¯‘å™¨å®ç°å¤‡ä»½
- ã€å®‰å…¨ã€‘Memvisor
- ã€BTã€‘DistriBitï¼Œåˆ†å¸ƒå¼çš„CrossBitï¼Œä¸¤å±‚TCacheè®¾è®¡ï¼ˆå…¨å±€+æœ¬åœ°ï¼‰

2011

- ã€ç‰¹å®šé—®é¢˜ã€‘é’ˆå¯¹å¤§å°ç«¯çš„å¤„ç†ï¼Œä¸¤ç§æ–¹å¼ï¼Œbyte swap å’Œ address swizzling
- ã€ä¼˜åŒ–ã€‘æ‰§è¡Œç¬¬ä¸€æ¬¡æ”¶é›†æ•°æ®ï¼Œç„¶åé™æ€åˆ†æå°†çƒ­ä»£ç é›†ä¸­ï¼ˆæé«˜å±€éƒ¨æ€§ï¼‰
- ã€BTã€‘MTCrossBitï¼Œæ‰©å±•CrossBitæ”¯æŒå¤šçº¿ç¨‹ï¼Œä¸€ä¸ªæ‰§è¡Œï¼Œä¸€ä¸ªä¼˜åŒ–ï¼Œä¸¤ä¸ªTCacheï¼ŒASLCæœºåˆ¶åŒæ­¥
- ã€BTã€‘GXBitï¼Œæ‰©å±•CrossBitè¿›è¡Œè‡ªåŠ¨å¹¶è¡ŒåŒ–ï¼Œç”ŸæˆPTXä»£ç æ¥è¿è¡Œåœ¨GPUä¸Š

2010

- ã€ä¼˜åŒ–ã€‘çƒ­ä»£ç é›†ä¸­
- ã€ä¼˜åŒ–ã€‘è·³è½¬åˆ†æï¼ŒFast Return
- ã€å®‰å…¨ã€‘åŸºäºCrossBitå®ç°CrossIFæ„å»ºäº†BufferSageTyï¼Œåˆ©ç”¨æ±¡ç‚¹åˆ†ææ¥æ£€æµ‹ç¼“å†²åŒºæº¢å‡º
- ã€BTã€‘DistriBitï¼Œåˆ†å¸ƒå¼çš„CrossBitï¼Œä¸¤å±‚TCacheè®¾è®¡ï¼ˆå…¨å±€+æœ¬åœ°ï¼‰ï¼Œé€šè®¯åè®®C/Sæ¶æ„

2009

- ã€BTã€‘CacheBitï¼Œæ”¯æŒæ¨¡æ‹ŸCacheçš„è¡Œä¸º
- ã€ä¼˜åŒ–ã€‘Fast Return
- ã€BTã€‘MTCrossBit
- ã€ä¼˜åŒ–ã€‘Profileï¼Œç¡¬ä»¶è®¡æ•°ï¼Œè½¯ä»¶åœ¨blockå¼€å¤´å†™SPCå‘Šè¯‰åº•å±‚ç¡¬ä»¶
- ã€ä¼˜åŒ–ã€‘å…ˆæ‰§è¡Œä¸€æ¬¡æ”¶é›†ä¿¡æ¯æ¥ä¼˜åŒ–
- ã€å®‰å…¨ã€‘system call çš„è§„åˆ™æ£€æµ‹
- ã€ä¼˜åŒ–ã€‘Condition Codesï¼ˆå—å†…å’Œå—é—´çš„ reductionï¼‰
- ã€ä¼˜åŒ–ã€‘ç¡¬ä»¶å®ç°è™šæ‹Ÿæœºåå¤„ç†å™¨ï¼Œè¿›è¡Œç¿»è¯‘ã€æŸ¥æ‰¾ç­‰å·¥ä½œï¼Œè½¯ä»¶åªè´Ÿè´£æ‰§è¡Œï¼Œæ¶ˆé™¤äº†ä¸Šä¸‹æ–‡åˆ‡æ¢
- ã€BTã€‘ä¸­é—´è¡¨ç¤ºçš„è®¾è®¡ï¼Œå‚è€ƒäº†LLVAå’ŒVCODE

2008

- ã€BTã€‘æ—©æœŸçš„MTCrossBit
- ã€ç‰¹å®šé—®é¢˜ã€‘æ”¯æŒDBTçš„è°ƒè¯•å™¨ï¼Œåœ¨ä¸­é—´è¯­è¨€ä¸­æ–°å¢BreakæŒ‡ä»¤æ¥æ·»åŠ æ–­ç‚¹
- ã€ä¼˜åŒ–ã€‘å¤šç§çƒ­è·¯å¾„è¯†åˆ«ç®—æ³•
- ã€ç‰¹å®šé—®é¢˜ã€‘æ”¯æŒæµ®ç‚¹è¿ç®—ï¼Œæ·»åŠ ä¸­é—´è¯­è¨€æŒ‡ä»¤
- ã€ä¼˜åŒ–ã€‘å¤šç§ä¸åŒçš„Code Cacheæ›¿æ¢ç®—æ³•åˆ†æ
- ã€BTã€‘vBTransï¼Œåœ¨XENä¸­è¿è¡ŒIA32ELï¼Œæ·»åŠ MMUã€ä¸­æ–­ã€IOçš„å¤„ç†ï¼Œæ”¯æŒç³»ç»Ÿæ€
- ã€BTã€‘Co-design CrossBitï¼Œç¡¬ä»¶ç¿»è¯‘ã€æŸ¥æ‰¾ï¼Œæ‰§è¡Œä¸ç¿»è¯‘åˆ†ç¦»ï¼ˆ09å¹´é‚£ç¯‡çš„å‰èº«ï¼Ÿï¼‰

2007

- ã€ä¼˜åŒ–ã€‘å¯åŠ è½½çš„ä¼˜åŒ–å™¨ï¼Œä¸­é—´è¯­è¨€å±‚é¢çš„ä¼˜åŒ–
- ã€BTã€‘CrossBit



# æ–‡ç« ç®€æ



## 2017 Nightingale: Translating Embedded VM Code in x86 BInary Executables

ç ”ç©¶äº†åŸºäºVMè§£é‡Šæ‰§è¡Œçš„ä»£ç ä¿æŠ¤æ–¹å¼ï¼Œå¹¶æå‡ºäº†ä¸€ä¸ªäºŒè¿›åˆ¶ç¿»è¯‘å·¥å…·æ¥ç®€åŒ–ï¼ˆä¼˜åŒ–ï¼‰åµŒå…¥å…¶ä¸­çš„é‚£ä¸ªVMã€‚

- In this paper we study the VM based obfuscation and propose a binary translation approach to simplify the embedded VM stub in a host program
  - NIGHTINGALE
    - an execution trace recording module (Intel PIN)
    - an offline program analysis module (Python)
    - a code patching module (Intel PIN)

- code protection: language embeddeding
  - customized form and embedded VM to execute it

![](./2017-embedded-vm.png)

- analysis a VM obfuscated executable
  - need to analyze the VM interpreter
  - (1) recover the structure of the used VM
    - the fetch/decode/execute loop
    - the instruction buffer
  - (2) then understand the obfuscated code
  - to conduct an embedded language disassembling to help understand it
- **ASSUMPTION**
  - each handler of the embedded languages's VM interpreter could be translated into a set of simple operations in host language



## 2017 é’ˆå¯¹ MIPS ç¨‹åºçš„é™æ€äºŒè¿›åˆ¶ç¿»è¯‘æŠ€æœ¯ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œæ”¯å¶ç››ï¼Œå¯¼å¸ˆï¼šè°·å¤§æ­¦
- é’ˆå¯¹MIPSç¨‹åºçš„è½»é‡çº§é™æ€äºŒè¿›åˆ¶ç¿»è¯‘ç³»ç»Ÿï¼ŒBabelFish
  - å°†MIPSè½¬æ¢ä¸ºLLVM-IRè¡¨ç¤º

![](./2017-mips-static-bt.png)

- VEX-IRæ˜¯äºŒè¿›åˆ¶æ’æ¡©å·¥å…·Valgrindçš„ä¸­é—´è¯­è¨€

å¯¹è·³è½¬ã€è°ƒç”¨ã€æ•°æ®æ®µå¤„ç†ç­‰åˆ†æéƒ½æ¯”è¾ƒç²—ç³™

ï¼ˆåŸæ–‡ä¸­ç”šè‡³ç›´æ¥æŠŠå¼•ç”¨æ–‡çŒ®çš„é¢˜ç›®å†™è¿›å»äº†ï¼Œè¿™çœŸçš„æ˜¯2017å¹´çš„æ¯•ä¸šè®ºæ–‡å—ï¼Ÿï¼ï¼‰



## 2017 åµŒå…¥å¼è®¾å¤‡åŠ¨æ€åˆ†ææ–¹æ³•ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œåˆ˜ç©†æ¸…ï¼Œå¯¼å¸ˆï¼šè°·å¤§æ­¦
- å®ç°ä¸€ä¸ªè·¨æ¶æ„æ¨¡æ‹Ÿå™¨ï¼Œè§£å†³åµŒå…¥å¼è®¾å¤‡çš„åŠ¨æ€åˆ†æ
  - åœ¨åŠ¨æ€é“¾æ¥å±‚é¢ï¼Œç›´æ¥åˆ©ç”¨æœ¬åœ°çš„åŠ¨æ€åº“
- æå‡ºäº†é’ˆå¯¹å‚å•†å®šåˆ¶ä»£ç çš„åˆ†ææ–¹æ³•
- å¯¹å›½å†…5ä¸ªåµŒå…¥å¼è®¾å¤‡è¿›è¡Œäº†å®é™…çš„åˆ†æï¼ˆã€‚ã€‚ã€‚ï¼‰



## 2015 è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹æ“ä½œç³»ç»Ÿå®‰å…¨æ€§å’Œæ€§èƒ½çš„ç ”ç©¶

å¹¶ä¸æ˜¯äºŒè¿›åˆ¶ç¿»è¯‘

ï¼ˆ1ï¼‰åˆ©ç”¨åµŒå¥—è™šæ‹ŸåŒ–åœ¨KVMåº•ä¸‹åˆåŠ äº†ä¸€å±‚ï¼Œæ¥æ§åˆ¶è®¿å­˜å’Œæ•°æ®åŠ å¯†

ï¼ˆ2ï¼‰ç”¨vCPU Ballooningæ¥ç»‘å®švCPUåˆ°ç‰©ç†æ ¸ï¼Œå‡å°‘vCPUçš„æ•°é‡ï¼Œé™ä½åŒé‡è°ƒåº¦é—®é¢˜å¯¼è‡´çš„è¿‡é«˜çš„å¼€é”€

- ç¡•å£«è®ºæ–‡ï¼Œç¼ªå¤©ç¿”ï¼Œå¯¼å¸ˆï¼šé™ˆæµ·æ³¢
- é’ˆå¯¹è™šæ‹ŸåŒ–ç¯å¢ƒä¸­çš„å®‰å…¨æ€§å’Œæ€§èƒ½è¿›è¡Œç ”ç©¶
- åŸºäºåµŒå¥—è™šæ‹ŸåŒ–ï¼Œå®ç°Secure KVMï¼Œåœ¨åŸKVMä¸‹æ·»åŠ å®‰å…¨åµŒå¥—å¼è™šæ‹ŸåŒ–å±‚
  - Secure KVMå æ®æœ€é«˜æƒé™ï¼ŒåŸKVMåœ¨non-rootæ¨¡å¼ä¸‹è¿è¡Œ
  - å†…å­˜éš”ç¦»æ¨¡å—ï¼šç»´æŠ¤L2æ­£å¸¸è¿è¡Œï¼Œç¦æ­¢L1è®¿é—®æ— å…³å†…å­˜
  - ç£ç›˜éš”ç¦»æ¨¡å—ï¼šå¯¹L2æ“ä½œè¿›è¡ŒåŠ è§£å¯†ï¼Œä½¿L1ä»…èƒ½æ¥è§¦åŠ å¯†åçš„æ•°æ®

![](./2015-vmos-secure-vm.png)

- åœ¨KVMå¹³å°ä¸Šå®ç°äº†FlexCoreï¼Œä¸€ä¸ªè™šæ‹ŸæœºåŠ¨æ€è°ƒåº¦ç³»ç»Ÿ
  - åˆ©ç”¨vCPU Ballooningæœºåˆ¶ï¼Œå‡å°‘è™šæ‹Ÿæœºçš„vCPUæ•°é‡æ¥é™ä½ç«äº‰
  - è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹çš„åŒé‡è°ƒåº¦ç°è±¡ï¼šçœŸå®coreå’ŒvCPU
    - é”çš„æ€§èƒ½ä¸‹é™ï¼švCPUè¿›å…¥é”ï¼Œä½†åœ¨çœŸå®coreä¸Šä»è¢«è°ƒåº¦
    - ![](./2015-vmos-funcipi.png)
    - ![](./2015-vmos-spinlock.png)
    - VMMè°ƒåº¦å™¨ä¸æ¸…æ¥šVMä¸­çš„å®é™…è¿è¡ŒçŠ¶å†µï¼Œå¯¼è‡´ä¸å‹å¥½çš„è°ƒåº¦
  - vCPU-Balï¼šå°†åŒé‡è°ƒåº¦è½¬åŒ–æˆä¸ºä¸€å±‚è°ƒåº¦ï¼ˆåº”è¯¥æ˜¯è®©vCPUç‹¬å æŸä¸ªæ ¸ï¼‰
  - Intelçš„PLEç‰¹æ€§ï¼šPause-Loop-Exiting
    - `PLE_Gap` ä¸¤æ¡ PAUSEæŒ‡ä»¤é—´éš”çš„æ—¶é’Ÿå‘¨æœŸæ•°
    - `PLE_Window` è§¦å‘vmexitçš„ä¸´ç•Œè‡ªå¾ªç¯æ¬¡æ•°
      - ä¸¤æ¡pauseä¹‹é—´è¶…è¿‡äº†`PLE_Gap` è®¤ä¸ºæ˜¯æ–°çš„å¾ªç¯å¼€å§‹
      - è‹¥æœªè¶…è¿‡ï¼Œåˆ™è®¡æ•°å¢åŠ ï¼Œç›´åˆ°è§¦å‘ vmexit
    - ä¸€æ®µæ—¶é—´å†…è¾ƒé«˜çš„ PLE æ¬¡æ•°ï¼Œè¯´æ˜å¤§é‡CPUæ—¶é—´è¢«æµªè´¹åœ¨å¿™ç­‰å¾…ä¸Šï¼Œä¸”ææœ‰å¯èƒ½æ˜¯ç”±äºåŒé‡è°ƒåº¦çš„å­˜åœ¨è€Œå¯¼è‡´çš„



## 2014 Multi-Granularity Memory Mirroring via Binary Translation in Cloud Environments

- memory errors å†…å­˜é”™è¯¯ï¼šå¤‡ä»½ã€æ¢å¤

> As the size of DRAM memory grows in clusters, **memory errors** are common.
>
> Current memory availability strategies mostly focus on **memory backup** and **error recovery**.

- this paper : memvisor

> In this paper, we present a novel system called Memvisor to provide high availability memory mirroring.
>
> It is a **software approach** achieving ï¬‚exible multi-granularity memory mirroring **based on virtualization and binary translation**.
>
> (1) ï¬‚exibly set memory areas to be mirrored or not from process level to the whole user mode applications.
>
> (2) Then, all memory write instructions are duplicated.
>
> - Data written to memory are synchronized to backup space in the instruction level
>
> (3) If memory failures happen, Memvisor will recover the data from the backup space

- static binary translation

![](./2014-memvisor-bt.png)



## 2012 Multimem: Retrofitting system availability via a lightweight binary translation framework

- è¿˜æ˜¯ memory failures

> As the size of memory in servers becomes larger and larger, the availability of them is under big pressure as **memory failures** are common.

- ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚ä½•è§£å†³ï¼šè¿ç§»ã€å®¹å¿ã€å¤‡ä»½

> To improve the memory availability, some solutions try to **mitigate the occurrence of memory errors** while most strategies focus on **memory failure tolerance**.
>
> Hardware solutions like **mirror memory** needs expensive peripheral equipments while existing software approaches are somewhat complicated and limited by the high overhead in practical usage.

- this paper: multimem

> In this paper, we present a novel lightweight binary translation framework called Multimem to improve system memory access availability.
>
> It is a software approach achieving hardware mirror memory feature via **static binary translation** technology.
>
> Multimem switches native systems to high available systems with two or more **copies of memory** so when memory failures happen, systems could **recover** the data from the replica.

- æ€ä¹ˆæ„Ÿè§‰å’Œ memvisor ä¸€æ¨¡ä¸€æ ·çš„æ–¹æ³•å‘¢ï¼Œæ¢äº†ä¸ªåå­—ï¼Ÿï¼Ÿï¼Ÿ



## 2012 Memvisor: Application Level Memory Mirroring via Binary Translation

- å’Œæ›´ä¸Šé¢çš„ä¸€ç¯‡ä¸€æ ·ï¼Œåªæ˜¯æ›´æ—©çš„ä¼šè®®è®ºæ–‡



## 2012 é¢å‘å—é™ç³»ç»Ÿçš„åˆ†å¸ƒå¼åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„åˆ†æä¸ç ”ç©¶

- åšå£«è®ºæ–‡ï¼Œä½œè€…ï¼šæ¨åŸå†¬ï¼ŒæŒ‡å¯¼æ•™å¸ˆï¼šç®¡æµ·å…µ
- ï¼ˆ1ï¼‰è™šæ‹Ÿä¸­é—´æŒ‡ä»¤é›†V-IISï¼Œï¼ˆå…¶å®å°±æ˜¯ä¸Šäº¤çš„CrossBitï¼‰
- ï¼ˆ2ï¼‰åˆ†å¸ƒå¼åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æ¡†æ¶ï¼ŒDistriBitï¼Œä¸ºç˜¦å®¢æˆ·ç«¯æœåŠ¡
- ï¼ˆ3ï¼‰ä¸ºDistriBitè®¾è®¡çš„ä»£ç ç¼“å­˜ç®¡ç†ç­–ç•¥
- ï¼ˆ4ï¼‰ä¼˜åŒ–ï¼šè™šæ‹Ÿæœºå¯„å­˜å™¨æ•°é‡ã€çƒ­è·¯å¾„å—çŠ¶ï¼ˆäº‘è®¡ç®—è™šæ‹Ÿåˆ†å¸ƒå¼ç¯å¢ƒï¼‰

![](./2012-crossbit.png)

- CrossBitçš„ä¼˜åŒ–
  - profileçƒ­è·¯å¾„ï¼šoverheadå’Œperformance
  - å¯„å­˜å™¨åˆ†é…ï¼šç›´æ¥åˆ†é…ã€ç‚¹å¯¹ç‚¹ã€å…¨å±€ã€next-use
  - è½¯ç¡¬ä»¶ååŒï¼šHardware(Transaltion, TCache Lookup) / Software(Execute)
- é«˜æ•ˆé€‚åº”æ€§è™šæ‹Ÿä¸­é—´æŒ‡ä»¤é›† V-IIS

![](./2012-distribit.png)

- ä¸¤çº§ä»£ç ç¼“å­˜ç®¡ç†ç­–ç•¥
  - å®¢æˆ·ç«¯æœ¬åœ°çš„TCacheç¼“å­˜ï¼šL1ï¼ˆçƒ­ä»£ç ã€è¶…çº§å—ï¼‰L2ï¼ˆå†·ä»£ç ï¼‰
  - å…¨å±€ä»£ç TCacheç®¡ç†



## 2011 Flexible Endian Adjustment for Cross Architecture Binary Translation

- å…³äºå¤§å°ç«¯çš„é—®é¢˜ï¼Œè™½ç„¶æ˜¯inconspicuousï¼ˆä¸æ˜æ˜¾çš„ï¼‰ï¼Œä½†æ˜¯ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆ

> The issue is inconspicuous but may lead to significant performance bottleneck.

- ç ”ç©¶äº†ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼šbyte swapå’Œaddress swizzling

> This paper investigates the key aspects of endianness and finds several solutions to endian adjustment for cross-architecture binary translation.
>
> In particular, it considers the two principal methods of this field â€” byte swapping and address swizzling, and gives a comparison of them in our DBT (Dynamic Binary Translator) CrossBit.

- Address Swizzledï¼šè¿›è¡Œåœ°å€è½¬æ¢ï¼Œæ¥é€‚é…hostçš„å¤§å°ç«¯ï¼ˆä¸€åˆ‡å‡é‡‡ç”¨äº†hostçš„å¤§å°ç«¯ï¼Œä»…ä¿®æ”¹è®¿å­˜åœ°å€ï¼‰
  - åˆå§‹æ•°æ®å¦‚ä½•å¤„ç†ï¼Ÿæ•°æ®æ®µä»ç„¶æŒ‰ç…§guestçš„å¤§å°ç«¯å­˜å‚¨ï¼ŸğŸ¤”

> Swizzled address = HighWMark âˆ’ (SIZE + EA âˆ’ LowWMark)

```markdown
0. little-endian guest and big-endian host
1. store 0x2000 4Bytes 0xABCD
store address = 0x2004 - (4 + 0x2000 - 0x2000) = 0x2000
//         0x2000, 0x2001, 0x2002, 0x2003
// little:      A,      B,      C,      D
// big   :      D,      C,      B,      A  // ç›´æ¥æŒ‰ç…§hostçš„è¿›è¡Œå†™å…¥ï¼Œåœ¨hostçœ‹æ¥æ˜¯0xABCDï¼Œåœ¨guestçœ‹æ¥æ˜¯0xDCBA
2. load 0x2002 2Bytes
load  address = 0x2004 - (2 + 0x2002 - 0x2000) = 0x2000 // åœ°å€è½¬æ¢
load  value   = 0xCD // ç›´æ¥æŒ‰ç…§hostçš„è¿›è¡Œè¯»å–ï¼Œå¾—åˆ°æ­£ç¡®çš„æ•°æ®
```

- Byte Swapï¼šæ€»æ˜¯è¿›è¡Œè½¬æ¢

```markdown
0. little-endian guest and big-endian host
1. store 0x2000 4Bytes 0xABCD => 0xDCBA
//         0x2000, 0x2001, 0x2002, 0x2003
// little:      D,      C,      B,      A  // hostæ•°æ®ï¼Œåœ¨hostçœ‹æ¥å­˜å‚¨çš„æ˜¯0xDCBA
// big   :      A,      B,      C,      D
2. load 0x2002 2Bytes
load  value   = 0xDC // æŒ‰ç…§hostçš„å¤§ç«¯è¯»å–
byte swapping = 0xCD // å¾—åˆ°æ­£ç¡®æ•°æ®
```

- å¥½åƒè¿›è¡Œåœ°å€è½¬æ¢çš„æ€§èƒ½ä¼šå¥½ä¸€äº›



## 2011 A Dynamic-Static Combined Code Layout Reorganization Approach for Dynamic Binary Translation

- ä¸€ä½œï¼šç®¡æµ·å…µ
- æŠŠhot codeæ”¾åœ¨software cacheçš„å¼€å¤´ï¼Œé›†ä¸­èµ·æ¥ï¼Œæé«˜locality

> In the static phase, based on the profile information collected in the previous stage, we first use the method of code replicating to build the traces, and then reorganize the layout of the target code by **putting the hottest traces at the top of the software cache**.

![](./2011-dynamic-static.png)

- å¥½åƒæµ‹è¯•éƒ¨åˆ†ä¸å¤ªå¯¹åŠ²å•Šï¼Œå›¾ç”»é”™äº†å§ï¼Œè¿™æ€§èƒ½éƒ½ä¸‹é™æ¥è¿‘ä¸€åŠäº†ã€‚ã€‚ã€‚ã€‚



## 2011 MTCrossBit: A dynamic binary translation system based on multithreaded optimization

- ä¸€ä½œï¼šç®¡æµ·å…µ
- å¤§éƒ¨åˆ†éƒ½æ˜¯å•çº¿ç¨‹ï¼Œæˆ‘ä»¬æå‡ºæ¥ä¸€ä¸ªå¤šçº¿ç¨‹çš„ï¼Œç”¨ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ä¼˜åŒ–

> We propose a **multithreaded** DBT framework with no associated hardware called the MTCrossBit, where a **helper thread for building a hot trace** is employed to signiï¬cantly reduce the overhead.

- ä¸¤ä¸ªæœºåˆ¶

> the dual-special-parallel translation caches and
>
> the new lock-free threads communication mechanismâ€”assembly language communication (ASLC).

- å‰è€…å°±æ˜¯ä¸¤ä¸ªcacheåˆ†å¼€ï¼ˆTCacheå’ŒSuperBlockCacheï¼‰æ¥é¿å…å¤šçº¿ç¨‹çš„ç«äº‰
- åè€…å°±æ˜¯ï¼Œç”¨æ±‡ç¼–è¯­è¨€ï¼ˆhostäºŒè¿›åˆ¶å§ï¼‰æ¥è¯»å†™ä¸€ä¸ªcounterè¿›è¡ŒåŒæ­¥ã€‚å—¯ï¼Œå°±æ˜¯è¿™æ ·ã€‚

è¿™è‹±æ–‡å†™å¾—å¤ªéš¾å—äº†ï¼Œè¯»èµ·æ¥ä¹Ÿéš¾å—......



## 2011 CPU/GPUå¼‚æ„å¤šæ ¸è™šæ‹Ÿæ‰§è¡Œç¯å¢ƒæ¡†æ¶çš„è®¾è®¡ä¸å®ç°

- ç¡•å£«è®ºæ–‡ï¼Œè‚–æ±‰æ³¢ï¼Œå¯¼å¸ˆï¼šæ¢é˜¿ç£Š
- Crossbitæ¥è¿›è¡Œè‡ªåŠ¨å¹¶è¡ŒåŒ–ï¼Œä»è€Œåˆ©ç”¨GPUçš„å¼ºå¤§å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œé¿å…é‡å†™æºä»£ç çš„å¤æ‚æ€§
- GXBitï¼šåˆ†æ :heavy_plus_sign: æ‰§è¡Œï¼Œé™æ€:heavy_plus_sign: åŠ¨æ€
  - æ‰©å±•äº†Crossbitçš„ä¸­é—´æŒ‡ä»¤
  - è¯†åˆ«å¾ªç¯ï¼Œæ„å»ºç©ºé—´å¤šé¢ä½“ï¼Œæ£€æµ‹å¯å¹¶è¡Œæ‰§è¡Œçš„éƒ¨åˆ†
  - PTXä»£ç ç”Ÿæˆã€åŠ è½½ã€æ‰§è¡Œ

![](./2011-gxbit.png)

- æµ‹è¯•ç¨‹åºï¼šçŸ©é˜µä¹˜ã€å¿«é€Ÿå‚…ç«‹å¶å˜æ¢ã€Parboilæµ‹è¯•å¥—ä»¶ï¼ˆMRI-FHDå’ŒMRI-Qï¼‰



## 2011 åŸºäºè™šæ‹Ÿæœº QEMU çš„åµŒå…¥å¼å…¨ç³»ç»Ÿä»¿çœŸæµ‹è¯•ç¯å¢ƒçš„ç ”ç©¶ä¸å®ç°

- ç¡•å£«è®ºæ–‡ï¼Œé²é¢–åŠ›ï¼Œå¯¼å¸ˆï¼šä½™æ¾ç…œã€å€ªçº¢è‹±

å“‡æ­£æ–‡è¯»ä¸ä¸‹å»ï¼Œçœ‹ä¸ªé¢˜ç›®å°±å¥½äº†ã€‚ã€‚ã€‚



## 2010 A New Approach to Reorganize Code Layout of Software Caceh in Dynamic Binary Translator

- Yunchao He, Kai Chen, Jinghui Gu, Haipeng Deng, Alei Liang, **Haibing Guan**

- è¯†åˆ«å‡ºCode Cacheä¸­çƒ­ä»£ç ï¼Œèšé›†åˆ°ä¸€èµ·ï¼Œæé«˜å±€éƒ¨æ€§ï¼ˆæ²¡é”™å’Œä¹‹å‰çš„ä¸€ç¯‡ä¸€æ ·ï¼‰

> In this paper, we designed a new approach using dynamic-static combined framework to reorganize code layout of software cache.

- OCL: Ordered Code Layoutï¼ˆæœ¬æ–‡çš„æ–¹å¼ï¼Œå…ˆæ‹¿åˆ°profileä¿¡æ¯ï¼Œç„¶åæ ¹æ®çƒ­åº¦æ’åºæ¥åŠ è½½ï¼‰
- RCL: Raw Code Layoutï¼ˆåŸå§‹çš„æ–¹å¼ï¼Œé»˜è®¤æŒ‰ç…§ç¿»è¯‘çš„é¡ºåºï¼‰
- PCL: Partitioned Code Layoutï¼ˆè¶…çº§å—çš„æ–¹å¼ï¼Œä¸¤ä¸ªcode cacheï¼‰

![](./2010-ocl.png)



## 2010 The Optimizations in Dynamic Binary Translation

- **Haibing Guan**, Hongbo Yang, Zhengwei, Qi, Yingdong Yang, Bo Liu

> This paper investigates a few optimizations to alleviate the overhead in DBT.
>
> We evaluate these optimizations in **CrossBit**, which is a resourceable and retargetable dynamic binary translator, including block **linking**, **condition codes** optimization, **register mapping** optimization, **static-integrated optimization**, **multithreaded** optimization.



## 2010 åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­è·³è½¬åˆ†æä¸ä¼˜åŒ–

- ç¡•å£«è®ºæ–‡ï¼Œå­™å»·éŸ¬ï¼Œå¯¼å¸ˆï¼šç®¡æµ·å…µ
- åˆ†æè·³è½¬æ•°æ®ï¼Œå®ç°inlineï¼Œhash tableï¼Œreturn cacheç­‰è·³è½¬ä¼˜åŒ–

![](./2010-crossbit-return.png)

- Fast Return æœºåˆ¶

> æºç¨‹åºçš„è¿”å›åœ°å€ç›´æ¥æ›¿æ¢æˆå¯¹åº”çš„ç¿»è¯‘åå—çš„åœ°å€



## 2010 åŸºäºåŠ¨æ€äºŒè¿›åˆ¶æ¢æµ‹æ¡†æ¶çš„ç¼“å†²åŒºæº¢å‡ºæ£€æµ‹ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œå®‹å¥•é’ï¼Œå¯¼å¸ˆï¼šé‚¹æ’æ˜
- ä»¥åŠ¨æ€äºŒè¿›åˆ¶æ¢æµ‹æ–¹æ³•å’Œæ±¡ç‚¹åˆ†ææ–¹æ³•ä¸ºæŒ‡å¯¼ï¼ŒåŸºäºCrossbitæ„å»ºæ¥CrossIFï¼Œå®ç°äº†BufferSafeTy
- æ±¡ç‚¹åˆ†æ Taint Analysis
  - å¯¹ç¨‹åºä½¿ç”¨çš„æ•°æ®è¿›è¡Œåˆ†æï¼Œå°†å…¶æ ‡è®°ä¸ºè¢«æ±¡æŸ“çš„ï¼ˆtaintedï¼‰å’Œå¹²å‡€çš„ï¼ˆcleanï¼‰ä¸¤ç±»
  - åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æ§åˆ¶æ±¡æŸ“å±æ€§çš„ä¼ é€’
  - å½“éæ³•ä½¿ç”¨è¢«æ±¡æŸ“æ•°æ®æ—¶ï¼Œå¯ä»¥æ–­è¨€æ”»å‡»è¡Œä¸ºçš„å­˜åœ¨
  - é™æ€æ±¡ç‚¹åˆ†æï¼šåµŒå…¥æºä»£ç çš„ç±»å‹åˆ†æä¸­ï¼Œé€šè¿‡ç¼–è¯‘å™¨è·å–ç±»å‹ä¿¡æ¯ï¼Œå®Œæˆæ±¡æŸ“å±æ€§ä¼ æ’­
  - åŠ¨æ€æ±¡ç‚¹åˆ†æï¼šè·Ÿè¸ªå˜é‡ã€å­˜å‚¨å•å…ƒã€å¯„å­˜å™¨ï¼Œæ£€æµ‹æ±¡æŸ“æ•°æ®çš„éæ³•ä½¿ç”¨

![](./2010-crossif.png)



## 2010 ç”¨äºå—é™ç³»ç»Ÿçš„åˆ†å¸ƒå¼åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æ¡†æ¶çš„è®¾è®¡ä¸å®ç°

2012å¹´ä¹Ÿæœ‰ä¸€ç¯‡å‘€ï¼ŒåŒä¸€ä¸ªå¯¼å¸ˆå“ï¼Œæ€ä¹ˆå›äº‹å‘¢

- ç¡•å£«è®ºæ–‡ï¼Œè¤šè¶…ï¼Œå¯¼å¸ˆï¼šç®¡æµ·å…µ
- åŸºäºCrossbitç ”ç©¶ä¸€ç§åŸºäºC/Sæ¶æ„çš„åˆ†å¸ƒå¼åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æ¡†æ¶
- ï¼ˆ1ï¼‰é€šè®¯åè®®çš„è®¾è®¡ï¼ˆ2ï¼‰æœåŠ¡ç«¯/å®¢æˆ·ç«¯è®¾è®¡ï¼ˆ3ï¼‰ä¸¤å±‚TCacheè®¾è®¡ï¼ˆ4ï¼‰æ€§èƒ½è¯„ä¼°



## 2009 The Implementation of Dynamic linking in Dynamic Binary Translation System

- Song Yiqing, He Yuemei, Liang Alei, **Guan Haibing**
- åŸºäºCrossBitï¼Œå®ç°DBTæ”¯æŒåŠ¨æ€é“¾æ¥ï¼ˆåº”è¯¥æ˜¯ç›´æ¥è°ƒç”¨æœ¬åœ°åŠ¨æ€åº“ï¼‰
- ï¼ˆ1ï¼‰Dynamic Loadingï¼šåŠ è½½åŠ¨æ€åº“åˆ°å†…å­˜ä¸­
- ï¼ˆ2ï¼‰Dynamic Resolvingï¼šè®¡ç®—functionçš„çœŸå®åœ°å€
- ï¼ˆ3ï¼‰Function Wrapï¼šæ„å»ºå‚æ•°ï¼Œè°ƒç”¨functionï¼Œå¹¶æ­£ç¡®è®¾ç½®å¥½è¿”å›å€¼



## 2009 CacheBit: A Multisource-Multitarget Cache Instrumentation Tool

- Chao Xu, Jinghui Gu, Ling Lin, Alei Liang, **Haibing Guan**
- ä¸€ä¸ªæ’æ¡©å·¥å…·Cachebitï¼ŒåŸºäºCrossbit

> Cachebit **simulates cache behavior** and presents statistics of cache profile at runtime.
>
> After running programs on Crossbit with Cachebit available, cache profile information can be reported to help developers rewrite and improve their programs.

ä¹Ÿå°±æ˜¯æ¨¡æ‹Ÿäº†cacheçš„è¡Œä¸ºå‘—ï¼ŒåŸºäºDBTå°±å¯ä»¥æ‹¿åˆ°æ‰€æœ‰çš„è®¿å­˜è¡Œä¸º

æˆ‘çš„è¯„ä»·æ˜¯ï¼šä¸å¦‚æ”¶é›†traceå¹¶åˆ†ææ¥å¾—æ›´å®¹æ˜“ï¼Œä½†æ¨¡æ‹Ÿcacheè¡Œä¸ºå¯ä»¥æä¾›æ›´å¤§çš„èƒ½åŠ›



## 2009 Return Instruction Analysis and Optimization in Dynamic Binary Translation

- Sun Tingtao, Yang Yindong, Yang Hongbo, **Guan Haibing**, Liang Alei

> In this paper, we present an improved **return cache** scheme with relative low overhead to handle the return instruction, the most important form of indirect branch.

![](./2009-return-cache.png)



## 2009 MTCrossBit: A Dynamic Binary Translation System Using Multithreaded Optimization Framework

- Xiaolong Li, Deen Zheng, Ruhui Ma, Alei Liang, and **Haibing Guan**
- ä¼šè®®ICA3PP
- å’Œ2011çš„å†…å®¹ä¸€æ ·ï¼šåˆ†å¼€çš„Cache :heavy_plus_sign: æ±‡ç¼–çš„åŒæ­¥ASLC



## 2009 A Runtime Profile Method for Dynamic Binary Translation Using Hardware-Support Technique

- **Haibing Guan**, Huibing Yang, Bo Liu, Alei Liang, Liang Liu, Ying Chen
- hardware profileå¾ˆç²¾ç¡®ä½†æ˜¯overheadå¾ˆå¤§ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªDBTå’Œhardwareç»“åˆçš„æ–¹æ³•

> In this paper, we propose a novel profile approach on DBT using hardware support technique to achieve rapidly and accurately collecting profile information with minimal runtime overhead.
>
> This approach makes use of **instrumentation code** and a set of profiling hardware which supports operations of updating **counters**.

![](./2009-fifo-profile.png)

- åœ¨æ¯ä¸ªé€‰ä¸­çš„blockçš„å¼€å§‹å¤„æ’å…¥ä¸€æ¡ç‰¹æ®Šçš„storeæŒ‡ä»¤

> The Store instruction is used to pass the first SPC of each block to the FIFO buffer.

- ç¡¬ä»¶è´Ÿè´£è®¡æ•°

![](./2009-fifo-counter.png)

ä¸ä¹‹å‰çš„ä¸€ä¸ªæƒ³æ³•ç±»å‹ï¼šåœ¨å†…å­˜æ¡ä¸Šæ’å…¥FPGAæ¥æˆªè·storeå’Œloadæ¥è¿›è¡Œé¢å¤–çš„è¿ç®—ï¼Œå¯ä»¥ç”¨æ¥è®¡æ•°å‘ç°çƒ­ç‚¹



## 2009 The Implementation of Static-integrated Optimization Framework for Dynamic Binary Translation

- Jinghui Gu, Chao Xu, Ling Lin, Juyu Zheng, Kai Chen, **Haibing Guan**
- åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­**å·®åŠ²**çš„profileä¿¡æ¯é™åˆ¶äº†ä¼˜åŒ–çš„ç©ºé—´ï¼Œè€Œç»“åˆé™æ€åˆ†æå°±å¯ä»¥æå‡å¾ˆå¤š

> In traditional Dynamic binary translation (DBT) systems, poor profile information at runtime limits the manner of optimization.
>
> Combining dynamic binary translation with static analysis brings an opportunity to improve the runtime performance.

- é¦–å…ˆæ‰§è¡Œä¸€æ¬¡æ¥æ”¶é›†åŠ¨æ€ä¿¡æ¯

> Optimization on the target code is mainly based on the profile information collected from the first execution.

è¿™ä¹ˆæåŸºæœ¬æ²¡ä»€ä¹ˆæ„æ€äº†ï¼Œè€Œä¸”åªå¾—åˆ°äº†5%çš„æ€§èƒ½æå‡



## 2009 A Heuristic Policy-based System Call Interposition in Dynamic Binary Translation

- Deen Zheng, Zhengwei Qi, Alei Liang, Hongbo Yang, **Haibing Guan**, Liang Liu
- è·¨æ¶æ„çš„å®‰å…¨é—®é¢˜ï¼Œå¤„ç† malicious programs å³æ¶æ„ç¨‹åº

> In this paper, we present HPSCIBit, a solution that efficiently confines malicious applications, supports **automatic policy generation** and **interactive policy generation**, **intrusion detection and prevention** in the DBT system.
>
> å…¥ä¾µçš„æ£€æµ‹å’Œé˜²æŠ¤

![](./2009-hpscibit.png)

- æ ¸å¿ƒä¼¼ä¹æ˜¯ä¸€ä¸ª`System Call Interposition Module` 
- ä½¿ç”¨äº† `Systrace-like pllicy language` æ¥æ„å»ºå®‰å…¨è§„åˆ™

```
N. Provos, "Improving Host Security with System Call Policies," In Proc. 12th USENIX security Symp., pp. 257-272,2003
```

![](./2009-hpscibit-policy.png)

çœ‹ä¸Šå»æ˜¯ä¸€äº›éå¸¸ç®€å•ç›´ç™½çš„è§„åˆ™æ¥ä¿æŠ¤ç³»ç»Ÿ



## 2009 A Two-Phase Optimization Approach for Condition Codes in a Machine Adaptable Dynamic Binary Translator

- Chu Chao, Zheng Juyu, **Guan Haibing**, Liang Alei
- é¦–å…ˆè¿›è¡Œå—å†…çš„ Flag Reduction

> First, redundant flag computing code in a basic block is reduced based on the information collected by Crossbit when the block is identified.

- ç„¶åè¿›è¡Œå»¶è¿Ÿçš„æ ¡éªŒ

> Then, lazy evaluation technique is used inter basic blocks, which make the condition codes emulation more efficient.

- å‡å°‘äº†å¤§æ¦‚ 37% çš„ native codes



## 2009 è·³è½¬é“¾æ¥æŠ€æœ¯åœ¨åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­çš„åº”ç”¨

- æ½˜ä¸½å›ï¼Œå§œç²ç‡•ï¼Œä¸Šæµ·äº¤é€šå¤§å­¦è½¯ä»¶å­¦é™¢ç¡•å£«ï¼Œ*å¾®å‹ç”µè„‘åº”ç”¨*
- ä»‹ç»äº†å‡ ç§è·³è½¬é“¾æ¥ï¼Œç„¶åè¯´Crossbitç”¨äº†è¿™äº›æŠ€æœ¯ã€‚ï¼ˆå°±è¿™ï¼‰



## 2009 è™šæ‹Ÿæœºçš„è½¯ç¡¬ä»¶ååŒè®¾è®¡æ–¹æ³•ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œ æåº­æ¶›ï¼Œå¯¼å¸ˆï¼šæ¢é˜¿ç£Š
- ç¡¬ä»¶åŠ é€Ÿçš„äºŒè¿›åˆ¶ç¿»è¯‘å™¨ï¼Œä¾ç„¶æ˜¯åŸºäºCrossbitï¼ˆä¼¼ä¹è¿˜æ˜¯ç”¨æˆ·çº§è€Œå·²ï¼‰

> é‡‡ç”¨FPGAå®ç°äº†è™šæ‹Ÿæœºåå¤„ç†å™¨ï¼ˆåŒ…æ‹¬äºŒè¿›åˆ¶ç¿»è¯‘å™¨ä»¥åŠTCacheç­‰éƒ¨ä»¶å•å…ƒï¼‰

- åˆ†ç¦»æ‰§è¡Œå’Œç¿»è¯‘ï¼Œæ¶ˆé™¤ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç¡¬ä»¶å•å…ƒå‡å°‘äº†TCacheçš„æŸ¥è¯¢æ—¶é—´

![](./2009-vcross-bit.png)

ç¡®è®¤æ˜¯ç”¨æˆ·æ€çš„äºŒè¿›åˆ¶ç¿»è¯‘äº†ï¼Œå¯ä»¥è§åŸæ–‡ç¬¬å››ç« çš„å›¾



## 2009 åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­çš„ä¸­é—´è¡¨ç¤º

- å§œç²ç‡•ï¼Œæ¢é˜¿ç£Šï¼Œ**ç®¡æµ·å…µ**ï¼›ä¸Šæµ·äº¤é€šå¤§å­¦è½¯ä»¶å­¦é™¢ï¼›*è®¡ç®—æœºå·¥ç¨‹*
- è®¾è®¡äº†VINSTï¼Œå‚è€ƒäº†LLVAå’ŒVCODE

```
[6] Adve V, Lattner C, Brukman M, et al. LLVA: A Low-level Virtual Instruction Set Architecture[C]//Proceedings of the 36th Annual IEEE/ACM International Symposium on Microarchitecture. San Diego, California, USA: [s. n.], 2003.
[7] Engler D R. VCODE: A Retargetable, Extensible, Very Fast Dynamic Code Generation System[C]//Proc. of ACM Conf. on Programming Language Design and Implementation. New York, USA: [s. n.], 1996.
```

- SSAå½¢å¼åŒ–å’Œå†—ä½™æŒ‡ä»¤åˆ é™¤
- åœ¨CrossBitä¸Šå®ç°ï¼Œæµ‹è¯•äº†SPEC2000çš„éƒ¨åˆ†benchmarkï¼ˆä¸ºä»€ä¹ˆä¸æ˜¯å…¨éƒ¨ï¼‰



## 2009 åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­çš„çƒ­è·¯å¾„ä¼˜åŒ–

- ç¡•å£«è®ºæ–‡ï¼Œèƒ¡å¤ï¼Œå¯¼å¸ˆï¼š**ç®¡æµ·å…µ**

- çƒ­è·¯å¾„è¯†åˆ« + è¶…çº§å—ç”Ÿæˆ + ä¸­é—´è¯­è¨€ä¼˜åŒ–

![](./2009-hot-codes.png)



## 2008 Multithreaded optimizing technique for dynamic binary translator CrossBit

- **Haibing Guan**, Bo Liu, Tingtao Li, Alei Liang
- ä¹Ÿå°±æ˜¯åˆ†ç¦»äº†Translationå’ŒExecutionå§ï¼Œå’Œ2009è¿˜æœ‰2011çš„ä¸¤ç¯‡ä¸€æ ·çš„

![](./2008-mtcrossbit.png)



## 2008 åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­çš„è°ƒè¯•å™¨ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œéƒ‘ä¸¾è‚²ï¼Œå¯¼å¸ˆï¼šæ­¥ä¸°æ—

- ä¼ ç»Ÿè°ƒè¯•å™¨æ— æ³•è°ƒè¯•è¢«åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„æŒ‡ä»¤
- ä¼ ç»Ÿè°ƒè¯•å™¨çš„æ¶æ„

![](./2008-debug.png)

- åœ¨ä¸­é—´è¯­è¨€æ·»åŠ ä¸€æ¡BREAKæŒ‡ä»¤æ¥å®ç°æ–­ç‚¹åŠŸèƒ½

![](./2008-debug-break.png)



## 2008 IA64ä½“ç³»ç»“æ„ä¸‹è™šæ‹ŸåŒ–IA32å†…å­˜ç®¡ç†å•å…ƒ

- ç¡•å£«è®ºæ–‡ï¼Œé‚¢å†²ï¼Œå¯¼å¸ˆï¼šä»˜å®‡å“
- ç³»ç»Ÿçº§äºŒè¿›åˆ¶ç¿»è¯‘å¯¹å†…å­˜çš„æ¨¡æ‹Ÿï¼ˆå®ç°ï¼Œè€Œä¸æ˜¯ä¼˜åŒ–ï¼‰
- è·¨é¡µï¼šç¦æ­¢è·¨é¡µè·³è½¬ï¼Œæˆ–åœ¨è¿›ç¨‹åˆ‡æ¢çš„æ—¶å€™æ–­å¼€æ‰€æœ‰çš„è·¨é¡µè·³è½¬
- SMCï¼šé€šè¿‡TLBçš„è¡¨é¡¹æ§åˆ¶ï¼Œè¢«ç¿»è¯‘è¿‡çš„é¡µå°†æ˜¯åªè¯»

åŸºæœ¬å’ŒQEMUçš„æ–¹æ³•ä¸€è‡´



## 2008 åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­åŸºäº profile çš„ä¼˜åŒ–ç®—æ³•ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œå²è¾‰è¾‰ï¼Œå¯¼å¸ˆï¼šç®¡æµ·å…µ

- ç¨‹åºè¿è¡Œæ—¶çš„ profileï¼Œçƒ­ä»£ç çš„è¯†åˆ«å’Œä¼˜åŒ–ï¼Œä»¥åŠ åŸºäº profile ä¿¡æ¯çš„ä»£ç  cache ç®¡ç†ã€‚

- æå‡ºäº†ä¸€ç§é«˜æ•ˆçš„åŸºäºè·¯å¾„çš„profileæ–¹æ³•

  - åŸºäºå—ã€åŸºäºè¾¹ã€åŸºäºä¸€æ¡è·¯å¾„

  - edge profilingï¼Œæ²¿ç€é¢‘ç‡æ›´é«˜çš„è¾¹å»¶ä¼¸å³å¯ã€16%å¼€é”€ã€‘

  - path profiling[36] å‡½æ•°å†…çš„æ— ç¯æ­£å‘è·¯å¾„ï¼Œä»¥å›è¾¹æˆ–è¿”å›ä½œä¸ºç»“å°¾ã€30%å¼€é”€ã€‘

  - ```
    [36] Thomas Ball, James R. Larus, â€œEfficient Path Profilingâ€, 29th Annual IEEE/ACM International Symposium on Microarchitecture, p. 46, 1996.
    ```

  - NETï¼šåœ¨é™ä½å¼€é”€çš„å‰æä¸‹ï¼Œå®ç°ä¸path profilingæ¥è¿‘çš„æ•ˆæœ

    - ä»…è®¡æ•°è·¯å¾„å¤´ï¼Œè¾¾åˆ°é˜ˆå€¼åè®°å½•è¿™ä¸€ç¬é—´ä»è¯¥è·¯å¾„å¤´å¼€å§‹çš„ä¸€æ¡è·¯å¾„ï¼ˆç¬é—´çŠ¶æ€ï¼‰

  - æœ¬æ–‡ï¼šå¯¹è·¯å¾„è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ï¼Œå¯¹äºçƒ­åº¦ç›¸è¿‘çš„è·¯å¾„ï¼Œæå–å‡ºå…¬å…±çš„çƒ­å—è¿›è¡Œè¶…çº§å—ä¼˜åŒ–

- code cacheç®¡ç†ï¼šæå‡ºäº†å¤šå±‚æ¬¡cacheï¼ŒæŒ‰ç…§profileçš„çƒ­åº¦ä¿¡æ¯å­˜å‚¨ï¼Œå‡å°‘ç¢ç‰‡å’Œæ›¿æ¢



## 2008 å¯é‡å®šå‘åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘å™¨ä¸­æµ®ç‚¹è¿ç®—å•å…ƒçš„è®¾è®¡ä¸å®ç°

- ç¡•å£«è®ºæ–‡ï¼Œç§¦é¹ï¼Œå¯¼å¸ˆï¼šæ­¥ä¸°æ—
- å¯¹CrossBitæ·»åŠ æµ®ç‚¹è¿ç®—çš„æ”¯æŒ
- Guestæ˜¯SimpleScalarï¼Œç¿»è¯‘åˆ°CrossBitçš„ä¸­é—´æŒ‡ä»¤ï¼Œæœ€ç»ˆç”Ÿæˆx87çš„æµ®ç‚¹æŒ‡ä»¤
- SimpleScalar[5] æ˜¯ä¸€ä¸ªä»¿çœŸå¹³å°ï¼Œå¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸ºECOFF

```
[5] D. Burger, T.M. Austin, and S. Bennett, Evaluating Future Microprocessors: The SimpleScalar Tool Set, Tech. Rep. CS-TR96-1308, Univ. Wisconsin, Madison, 1996.
```



## 2008 åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ä¸­çš„TCacheæ›¿æ¢ç®—æ³•

- é©¬èˆ’å…°ï¼Œ*è®¡ç®—æœºåº”ç”¨ä¸è½¯ä»¶*
- ä»‹ç»äº†ä¸åŒçš„Code Cacheæ›¿æ¢ç®—æ³•
- ç»“è®ºï¼šç²’åº¦é€‚ä¸­çš„ç²—ç²’åº¦çš„FIFOç®—æ³•ç»¼åˆæ€§èƒ½æœ€å¥½ï¼Œç»“åˆäº†å…¨æ¸…ç©ºå’Œå…ˆè¿›å…ˆå‡ºçš„ä¼˜ç‚¹

2002å¹´å°±è¢«æµ‹è¯•è¿‡äº†å§...ç»“è®ºä¹Ÿä¸€è‡´



## 2008 åŸºäºåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œé¾™å¼€æ–‡ï¼Œå¯¼å¸ˆï¼šä»˜å®‡å“
- DBTå®ç°å®Œå…¨è™šæ‹ŸåŒ–çš„è™šæ‹Ÿæœºç®¡ç†å™¨vBtransï¼Œå¯åœ¨Itaniumï¼ˆIA64ï¼‰ä¸Šè¿è¡ŒIA32æ“ä½œç³»ç»Ÿ
- vBtransï¼šç»“åˆXENå’Œåº”ç”¨çº§äºŒè¿›åˆ¶ç¿»è¯‘å™¨IA32-EL
- é‡‡ç”¨æ¾è€¦åˆçš„æ–¹å¼ï¼ŒæŠŠIA32-ELè¿è¡Œåœ¨ç”±XENè™šæ‹ŸåŒ–å‡ºIA64ç¯å¢ƒä¸­ï¼Œæ”¯æŒIA32çš„æ“ä½œç³»ç»Ÿè¿è¡Œ

![](./2008-vBtrans.png)

- ä¸»è¦æ¶‰åŠäº†MMUå’ŒTLBã€ä¸­æ–­çš„æ¨¡æ‹Ÿã€IOçš„æ¨¡æ‹Ÿ

  - å†…å­˜ï¼šéå†IA32çš„é¡µè¡¨ï¼Œæ·»åŠ åˆ°èº«ä¸ºhostçš„IA64çš„TLBä¸­ï¼Œæ”¯æŒIA32çš„è®¿å­˜

  - > vBtransä¸­ç¦ ç”¨äº†VHPTï¼Œå¹¶ä¸”åœ¨ç‰©ç†æ¨¡å¼ä¸‹å·²ç»åœ¨TLBä¸­å»ºç«‹å¥½äº†ä»¥ä¸‹ä¸‰ç±»åœ°å€ç©ºé—´çš„è™šå®åœ°å€æ˜ å°„
    >
    > 1. vBtransçš„ä»£ç å’Œæ•°æ®ï¼ŒåŒ…æ‹¬å †æ ˆç©ºé—´
    > 2. vBtransçš„å †ç©ºé—´ï¼Œå­˜æ”¾ç¿»è¯‘ç”Ÿæˆçš„ä»£ç 
    > 3. vBtranså¯¹IA-32ç‰©ç†åœ°å€çš„å½±å­æ˜ å°„ï¼ŒåŒ…æ‹¬RAMå’ŒPIO,MMIOç©ºé—´

  - ä¸­æ–­ï¼šæ¨¡æ‹ŸIA32çš„ä¸­æ–­æäº¤è¿‡ç¨‹

  - IOï¼šæ¨¡æ‹ŸIN/OUTå’ŒMMIO

  - > ç”Ÿæˆçš„æ¨¡æ‹ŸIN/OUTæŒ‡ä»¤åŠŸèƒ½çš„ä»£ç ï¼Œé€šè¿‡ä¸€èˆ¬çš„è®¿å­˜æŒ‡ä»¤LD/ST æ¥è¯»å–I/Oåœ°å€ï¼Œå½“å‘ç”ŸTLB missæ—¶ï¼Œè®¡ç®—å‡ºæ­£ç¡®çš„åœ°å€å¡«å…¥å³å¯
    >
    > ä¸å°†MMIOç©ºé—´æ”¾å…¥TLBï¼Œä»è€Œæ‹¦æˆªæ‰€æœ‰çš„MMIOè¯·æ±‚

- ä¼˜åŒ–ï¼šç‰©ç†åœ°å€ç´¢å¼•çš„ç¿»è¯‘å—ã€é€‚åº”MMIOçš„ç¿»è¯‘æ–¹å¼



## 2008 åŸºäºè½¯ç¡¬ä»¶ååŒè®¾è®¡çš„è™šæ‹Ÿæœºçš„å¹¶è¡Œæ€§ç ”ç©¶

- ç¡•å£«è®ºæ–‡ï¼Œåˆ˜åšï¼Œå¯¼å¸ˆï¼šæ¢é˜¿ç£Š
- æå‡ºäº†å¹¶è¡ŒåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æ¨¡å‹ã€‚(æ‰§è¡Œä¸ç¿»è¯‘/ä¼˜åŒ–åˆ†ç¦»ï¼Œè€Œä¸”éƒ½æ˜¯ç¡¬ä»¶å®ç°)

> å¹¶è¡Œç³»ç»Ÿé€šè¿‡å°†åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘çš„ä»»åŠ¡åˆ†é… åˆ°ä¸¤ä¸ªå¤„ç†æ ¸ä¸Šæ‰§è¡Œï¼Œå°†ä»£ç ç¿»è¯‘ ã€profile ä¿¡æ¯æ”¶é›†ã€ç¼“å­˜ç»´æŠ¤ã€ æº-ç›®æ ‡æ‰§è¡Œä»£ç å…¥å£åœ°å€ç­‰ä»»åŠ¡ä»äºŒè¿›åˆ¶ç¿»è¯‘å™¨ä¸­æºç»“æ„æŒ‡ä»¤ æ‰§è¡Œçš„å…³é”®è·¯å¾„ä¸Šåˆ†ç¦»å‡ºæ¥ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ä¸å®æ—¶æ€§ã€‚

- ç¡¬ä»¶ç¿»è¯‘ã€ç®¡ç†TCacheã€å®ç°éƒ¨åˆ†ä¼˜åŒ–

> ç¡¬ä»¶ç¿»è¯‘å•å…ƒä¸»è¦å…·å¤‡åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ï¼ŒTCache ç®¡ç†åŠŸèƒ½ä»¥åŠéƒ¨åˆ†ä¼˜åŒ–æœºåˆ¶ çš„å®ç°ç­‰åŠŸèƒ½ã€‚

![](./2008-hw-sw-bt.png)

- Co-design CrossBit ç³»ç»Ÿçš„æ€»ä½“ç»“æ„

> è½¯ä»¶å±‚åŒ…æ‹¬ IA-32 å¯æ‰§è¡Œæ–‡ä»¶çš„åŠ è½½å™¨å’Œè™šæ‹Ÿ æœº IP æ ¸é©±åŠ¨ç¨‹åºä»¥åŠ Linux æ“ä½œç³»ç»Ÿã€‚
>
> ç¡¬ä»¶éƒ¨åˆ†åŒ…æ‹¬ PowerPC å¤„ç†å™¨ã€å†…å­˜å’Œè™šæ‹Ÿæœº IP æ ¸ã€‚
>
> > å…¶ä¸­è™šæ‹Ÿæœºçš„ IP æ ¸ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šäºŒè¿›åˆ¶ç¿»è¯‘å™¨å’Œ TCache ç®¡ç†å™¨ã€‚
>
> è½¯ä»¶ä¸ç¡¬ä»¶ä¹‹é—´çš„é€šä¿¡é—®é¢˜ç”±å…±äº«å­˜å‚¨çš„æ–¹å¼è§£å†³ã€‚

- ç¡¬ä»¶ä¸Šå¾®ç å®ç°è§£é‡Šæ‰§è¡Œçš„æ”¯æŒ

> è½¯ç¡¬ä»¶ååŒè®¾è®¡è™šæ‹Ÿæœºä½¿ç”¨å¾®ä»£ç å®ç°è§£é‡Šå™¨

- ç¡¬ä»¶profile

> ç¡¬ä»¶ profile è¿˜ ä¸ºåŠ¨æ€ç¿»è¯‘ä¸­åŸºæœ¬å—çš„ç”Ÿæˆå’Œé€‰å–æä¾›è·¯å¾„æè¿°ç¬¦ï¼Œæ‰§è¡Œè®¡æ•°å’ŒæŒ‡ä»¤å—å¤§å°ç­‰æ•° æ®æ”¯æŒã€‚ä¼˜åŒ–å™¨è¿˜å¯ä»¥æ ¹æ®æ¢æµ‹åˆ°çš„æŒ‡ä»¤æ¨¡å¼è°ƒæ•´ TCache ä¸­çƒ­ç‚¹è·¯å¾„çš„äº§ç”Ÿå’Œ ç›‘æµ‹æ–¹å¼ã€‚

- è½¯ç¡¬ä»¶ååŒå¹³å°çš„å¹¶è¡Œç¿»è¯‘ä¼˜åŒ–æ¨¡å‹

![](./2008-hw-sw-bt-thread.png)



## 2007 An Intermediate Language Level Optimization Framework for Dynamic Binary Translation

- Huihui Shi, Yi Wang, **Haibing Guan**, Alei Liang

> The framework proposed in this paper includes efficient **profiling**, **hot code** recognition and smart **code cache** management policies.

- ä¼˜åŒ–å™¨æ˜¯å¯åŠ è½½çš„æ¨¡å—

> An optimizer is a loadable tool that coexists with other components in the middle layer of the dynamic binary translation system.

![](./2007-dbt.png)



## 2007 äºŒè¿›åˆ¶ç¿»è¯‘ç³»ç»Ÿ QEMU çš„ä¼˜åŒ–æŠ€æœ¯

- ç¡•å£«è®ºæ–‡ï¼Œå´æµ©ï¼Œå¯¼å¸ˆï¼šææ™“å‹‡

- å—¯ï¼Œç ”ç©¶äº†ä¸€ä¸‹QEMU

> æœ¬æ–‡çš„ä¸»è¦è´¡çŒ®ä¸ºç ”ç©¶äº†ç›®å‰äºŒè¿›åˆ¶ç¿»è¯‘é¢†åŸŸçš„å…¸å‹ç¿»è¯‘ç³»ç»Ÿï¼Œè¯¦ç»†ç ”ç©¶äº† åŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ç³»ç»ŸQEMUçš„ç¿»è¯‘æœºåˆ¶ã€è¿è¡Œæ–¹å¼ã€ç¿»è¯‘ç­–ç•¥ï¼Œå¹¶ä½¿ç”¨å…¶ç”¨æˆ·çº§ç³» ç»Ÿä½œä¸ºæˆ‘ä»¬çš„å®éªŒå¹³å°ã€‚

- æµ‹è¯•äº†å¯„å­˜å™¨åˆ†é…ï¼šARM(guest) to X86(host)

> é’ˆå¯¹QEMUåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘ç³» ç»Ÿä¸­å°†ä¸­é—´å˜é‡æ˜ å°„åˆ°å®¿ä¸»æœºå¯„å­˜å™¨ä¸Šçš„ç¿»è¯‘æœºåˆ¶ï¼Œå¯¹å¯„å­˜å™¨çš„ä¸åŒæ˜ å°„æ–¹æ¡ˆè¿› è¡Œäº†æ€§èƒ½æµ‹è¯•ã€‚å‘ç°äº†åœ¨ç›®å‰ç¿»è¯‘æœºåˆ¶ä¸‹ï¼Œä¸­é—´å˜é‡çš„ç¡®æ˜¯ä½¿ç”¨æœ€ä¸ºé¢‘ç¹ï¼Œæœ€æœ‰ ä»·å€¼æ˜ å°„çš„éƒ¨åˆ†ã€‚æœ€åæå‡ºäº†å–æ¶ˆä¸­é—´å˜é‡çš„æ–°ç¿»è¯‘æœºåˆ¶è®¾æƒ³ã€‚

- å‘ç°äº†åŸºæœ¬å—ç›¸äº’è¦†ç›–çš„æƒ…å†µ

> é’ˆå¯¹QEMUåŠ¨æ€äºŒ è¿›åˆ¶ç¿»è¯‘ç³»ç»Ÿä¸­æ¯ä¸ªåŸºæœ¬å—ä»¥å¤´æŒ‡ä»¤pcä½œä¸ºå”¯ä¸€æ ‡è¯†çš„æ–¹å¼ï¼Œå‘ç°äº†åŸºæœ¬å—è¦†ç›– çš„å­˜åœ¨ã€‚å³åŸºæœ¬å—å¯èƒ½æ˜¯æŸä¸ªåŸºæœ¬å—çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæœ‰å¯èƒ½åŒ…æ‹¬ä¸€äº›åŸºæœ¬å—ã€‚å¯¹æ­¤ æå‡ºäº†å‡å°‘åŸºæœ¬å—è¦†ç›–ç°è±¡çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”å°†å…¶å®ç°ã€‚



## 2007 æ„å»ºåŸºäºåŠ¨æ€äºŒè¿›åˆ¶ç¿»è¯‘æŠ€æœ¯çš„è¿›ç¨‹è™šæ‹Ÿæœº

- ç¡•å£«è®ºæ–‡ï¼ŒåŒ…äº‘ç¨‹ï¼Œå¯¼å¸ˆï¼šé™ˆè‹±
- è®¾è®¡äº†CrossBitï¼Œå°† SimpleScalar ç¨‹åºè¿è¡Œåœ¨ x86 ç‰©ç†æœºå™¨ä¸Š

> CrossBit çš„è®¾è®¡ç›®æ ‡æ˜¯å¯é‡å®šå‘å’Œå¯æ‰©å±•ã€‚å®ç°å¯é‡å®šå‘çš„å…³é”® åœ¨äºä¸­é—´æŒ‡ä»¤é›† VInstã€‚

![](./2007-crossbit.png)

- LLVAï¼ˆLow-Level Virtual Instruction Set Architectureï¼‰[29]æ˜¯ä¸€ç§ä¸ºä»£ç å…¨ç”Ÿ å‘½æœŸï¼ˆåŒ…æ‹¬ç¼–è¯‘ã€é“¾æ¥ã€è¿è¡Œæ—¶ï¼‰ä¼˜åŒ–è®¾è®¡çš„è™šæ‹Ÿæœºå™¨æŒ‡ä»¤é›†ï¼Œå…¶ç‰¹ç‚¹æ˜¯åœ¨ä½çº§ åˆ«çš„è™šæ‹Ÿæœºå™¨æŒ‡ä»¤ä¸­åŒ…å«äº†ä¼˜åŒ–ç®—æ³•æ‰€éœ€è¦çš„æ§åˆ¶æµã€æ•°æ®æµå’Œæ•°æ®ä¾èµ–ç­‰é«˜çº§ åˆ«ä¿¡æ¯ï¼Œè¿™äº›è¯­ä¹‰ä¿¡æ¯åœ¨ä¸€èˆ¬çš„ç‰©ç†æœºå™¨ä»£ç ä¸­å¾ˆéš¾æå–å‡ºæ¥

```
[29] V. Adve, C. Lattner, M. Brukman, A. Shukla, and B. Gaeke, LLVA: A Low-level Virtual Instruction Set Architecture, MICRO-36, San Diego, California, 2003.
```



## 2005 GXBIT: Combining Polyhedral Model with Dynamic Binary Translation

- Zhang Kang, Zhou Fanfu, Liang ALei
- Analysis + Execution

> Analysis stage uses binary instrumentation and binary analysis to probe potential parallel parts (usually nested loop) of a binary executable and then polyhedral model is employed to detect whether there is data dependence or not among all iterations of a nested loop.

- 2011å¹´æœ‰ç¯‡ç¡•å£«è®ºæ–‡è®²äº†è¿™ä¸ªä¸œè¥¿ï¼Œå¤§æ¦‚å°±æ˜¯å¯»æ‰¾å¹¶è¡ŒåŒ–ä»£ç ï¼Œç„¶åç¿»è¯‘æˆPTXè¿è¡Œåœ¨GPUä¸Š

![](./2007-gxbit.png)













